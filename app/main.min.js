!function(){APP={},APP.ArtPiece=Backbone.Model.extend({defaults:{first_name:"First Name not provided",title:"Title not provided",location:"Location not provided",description:"Description not provided",last_name:"Last Name not provided",longitude:null,latitude:null,type:"Type not provided",medium:"Medium not provided"},initialize:function(){},address:function(){}}),APP.ArtPieces=Backbone.Collection.extend({model:APP.ArtPiece,url:"https://data.nashville.gov/resource/dqkw-tj5j.json"}),APP.artPieces=new APP.ArtPieces,APP.Map=Backbone.Model.extend({defaults:{center:new google.maps.LatLng(36.15948,-86.792112),zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP}}),APP.MarkerInfo=Backbone.Model.extend({"default":{first_name:"First Name not provided",last_name:"Last Name not provided",title:"Title not provided",location:"Location not provided",description:"Description not provided",type:"Type not provided",medium:"Medium not provided",address:"Not Available"},getAddress:function(a,b){geocoder=new google.maps.Geocoder;var c=new google.maps.LatLng(a,b);geocoder.geocode({latLng:c},function(a,b){return b==google.maps.GeocoderStatus.OK?a[1]?a[1].formatted_address:"No address available":"No Address Provided. Google screwed us!"})}}),APP.map=new APP.Map,APP.MapView=Backbone.View.extend({el:"#map",initialize:function(){this.collection.fetch({reset:!0}),this.listenTo(this.collection,"reset",this.render),this.map=new google.maps.Map(this.el,this.model.toJSON())},render:function(){var a=[];mapView=this,this.collection.each(function(b){var c=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(b.get("latitude"),b.get("longitude")),title:b.get("title"),markerId:b.cid}),d='<div class="info-window"><p class="info-title">'+b.get("title")+"</div>",e=new google.maps.InfoWindow({content:d,infoId:b.cid});a[a.length]=e,google.maps.event.addListener(c,"click",function(){for(this.map.setZoom(14),this.map.setCenter(c.position),i=0;i<a.length;i++)a[i].close();mapView.displayInformation(c),e.open(this.map,c)})},this),$("#map").replaceWith(this.el),google.maps.event.addDomListener(window,"load",initialize)},displayInformation:function(a){console.log(this.collection.get(a.markerId))}}),APP.markerInfoBox=Backbone.View.extend({el:"div",template:_.template($("#marker-info-box").html()),initialize:function(){this.listenTo(this.model,"change",this.render()),this.render()},render:function(){this.getAddress(),this.$el.html(this.template(this.model.toJSON()))},getAddress:function(){this.model.set("address",this.model.getAddress(this.model.latitude,this.model.longitude))}}),APP.mapView=new APP.MapView({model:APP.map,collection:APP.artPieces})}();